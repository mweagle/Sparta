<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Example 1  &middot; Sparta</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="sparta, ">


<meta property="og:title" content="Example 1  &middot; Sparta ">
<meta property="og:site_name" content="Sparta"/>
<meta property="og:url" content="http://gosparta.io/docs/apigateway/example1/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2015-11-29T06:50:17Z" />
<meta property="og:article:modified_time" content="2015-11-29T06:50:17Z" />

  
    
<meta property="og:article:tag" content="sparta">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="Example 1" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="http://gosparta.io/docs/apigateway/example1/" />
<meta name="twitter:domain" content="http://gosparta.io">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Example 1",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2015-11-29",
    "description": "",
    "wordCount":  1084 
  }
</script>



<link rel="canonical" href="http://gosparta.io/docs/apigateway/example1/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://gosparta.io/touch-icon-144-precomposed.png">
<link href="http://gosparta.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.15" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="http://gosparta.io/css/theme/yeti.css">


<link rel="stylesheet" href="http://gosparta.io/css/font-awesome.min.css">
<link rel="stylesheet" href="http://gosparta.io/css/style.css">


  <link rel="stylesheet" href="http://gosparta.io/css/highlight/default.css">


  
  <script src="/mermaid/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:true});</script>
  <link rel="stylesheet" href="/mermaid/mermaid.css"></link>
  <link rel="stylesheet" href="/css/mermaid-overrides.css"></link>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-70794971-2', 'auto');
    ga('send', 'pageview');
  </script>
</head>
<body class="map[home:Home googleAnalytics:UA-70794971-1 linkedin:https://www.linkedin.com/in/mweagle googleplus: facebook: twitter:mweagle youtube: flattr: name:yeti highlight:vs github:https://github.com/mweagle bitbucket:]">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://gosparta.io">Sparta</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li>

            <a href="http://gosparta.io/docs"
            >

            
                <i class="fa fa-book"></i>
            
            
            Documentation
            </a>
          </li>
          
          <li>

            <a href="https://github.com/mweagle/Sparta"
            >

            
                <i class="fa fa-github"></i>
            
            
            GitHub
            </a>
          </li>
          
          <li>

            <a href="http://gosparta.io/tags"
             title="Show list of tags">

            
                <i class="fa fa-tags"></i>
            
            
            Tags
            </a>
          </li>
          
          <li>

            <a href="https://twitter.com/@mweagle"
            >

            
                <i class="fa fa-twitter"></i>
            
            
            mweagle
            </a>
          </li>
          
        </ul>
      </div>
      
    </div>
  </nav>

</header>


<div class="container">
<div class="row">
  <div class="col-md-2"><div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Contents</h3>
  </div>
  <div class="panel-body">
    
      <a href="/docs/overview">Overview</a>
      <ul>
      
      </ul>
    
      <a href="/docs/commandline">Command Line</a>
      <ul>
      
      </ul>
    
      <a href="/docs/walkthrough">Walkthrough</a>
      <ul>
      
      </ul>
    
      <a href="/docs/eventsources">Event Sources</a>
      <ul>
      
        <li>
          <small><a href="/docs/eventsources/s3">S3</a></small>
        </li>
      
        <li>
          <small><a href="/docs/eventsources/sns/">SNS</a></small>
        </li>
      
        <li>
          <small><a href="/docs/eventsources/dynamodb">DynamoDB</a></small>
        </li>
      
        <li>
          <small><a href="/docs/eventsources/kinesis">Kinesis (TBD)</a></small>
        </li>
      
        <li>
          <small><a href="/docs/eventsources/ses">SES (TBD)</a></small>
        </li>
      
        <li>
          <small><a href="/docs/eventsources/cognito">Cognito (TBD)</a></small>
        </li>
      
        <li>
          <small><a href="/docs/eventsources/cloudwatchlogs">CloudWatch Logs (TBD)</a></small>
        </li>
      
        <li>
          <small><a href="/docs/eventsources/cloudformation">CloudFormation (TBD)</a></small>
        </li>
      
      </ul>
    
      <a href="/docs/apigateway">API Gateway</a>
      <ul>
      
        <li>
          <small><a href="/docs/apigateway/example1">Echo</a></small>
        </li>
      
        <li>
          <small><a href="/docs/apigateway/example2">User Input</a></small>
        </li>
      
        <li>
          <small><a href="/docs/apigateway/example3">GeoIP Service</a></small>
        </li>
      
      </ul>
    
      <a href="/docs/miscellaneous">Miscellaneous</a>
      <ul>
      
      </ul>
    
      <a href="/docs/limitations">Limitations</a>
      <ul>
      
      </ul>
    
  </div>
</div>
</div>
  <div class="col-md-8">
    <header class="container hat">
  <h1>Example 1
</h1>

</header>

    <div class="container content">
  

<h2 id="a-href-hugoshortcode-1-echo-a:d680e8a854a7cbad6d490c445cba2eba"><a href="#exampleEcho:d680e8a854a7cbad6d490c445cba2eba">Echo</a></h2>

<p>To start, we&rsquo;ll create a HTTPS accessible lambda function that simply echoes back the contents of the Lambda event.  The source for this is the <a href="https://github.com/mweagle/SpartaApplication/blob/master/application.go#L43">SpartaApplication</a>.</p>

<p>For reference, the <code>echoS3Event</code> function is below.</p>

<pre><code class="go">func echoS3Event(event *json.RawMessage, context *sparta.LambdaContext, w http.ResponseWriter, logger *logrus.Logger) {
	logger.WithFields(logrus.Fields{
		&#34;RequestID&#34;: context.AWSRequestID,
		&#34;Event&#34;:     string(*event),
	}).Info(&#34;Request received&#34;)

	fmt.Fprintf(w, string(*event))
}</code></pre>


<h3 id="a-href-hugoshortcode-3-create-the-api-gateway-a:d680e8a854a7cbad6d490c445cba2eba"><a href="#example1API:d680e8a854a7cbad6d490c445cba2eba">Create the API Gateway</a></h3>

<p>The first requirement is to create a new <a href="https://godoc.org/github.com/mweagle/Sparta#API">API</a> instance via <code>sparta.NewAPIGateway()</code></p>

<pre><code class="go">stage := sparta.NewStage(&#34;prod&#34;)
apiGateway := sparta.NewAPIGateway(&#34;MySpartaAPI&#34;, stage)</code></pre>


<p>In the example above, we&rsquo;re also including a <a href="https://godoc.org/github.com/mweagle/Sparta#Stage">Stage</a> value.  A non-<code>nil</code> Stage value will cause the registered API to be deployed.  If the Stage value is <code>nil</code>, a REST API will be created, but it will not be <a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-deploy-api.html">deployed</a> (and therefore not publicly accessible).</p>

<h3 id="a-href-hugoshortcode-5-create-a-resource-a:d680e8a854a7cbad6d490c445cba2eba"><a href="#example1API:d680e8a854a7cbad6d490c445cba2eba">Create a Resource</a></h3>

<p>The next step is to associate a URL path with the <code>sparta.LambdaAWSInfo</code> struct that represents the <em>Go</em> function:</p>

<pre><code class="go">apiGatewayResource, _ := api.NewResource(&#34;/hello/world/test&#34;, lambdaFn)
apiGatewayResource.NewMethod(&#34;GET&#34;)</code></pre>


<p>Our <a href="https://github.com/mweagle/SpartaApplication/blob/master/application.go#L34">echoS3Event</a> only supports <code>GET</code>.  We&rsquo;ll see how a single lambda function can support multiple HTTP methods shortly.</p>

<h3 id="a-href-hugoshortcode-7-provision-a:d680e8a854a7cbad6d490c445cba2eba"><a href="#example1API:d680e8a854a7cbad6d490c445cba2eba">Provision</a></h3>

<p>The final step is to to provide the API instance to <code>Sparta.Main()</code></p>

<pre><code class="go">stage := sparta.NewStage(&#34;prod&#34;)
apiGateway := sparta.NewAPIGateway(&#34;MySpartaAPI&#34;, stage)
stackName := &#34;SpartaApplication&#34;
sparta.Main(stackName,
  &#34;Simple Sparta application&#34;,
  spartaLambdaData(apiGateway),
  apiGateway)</code></pre>


<p>Once the service is successfully provisioned, the <code>Outputs</code> key will include the API Gateway Deployed URL (sample):</p>

<p><pre><code class="javascript">[{
    Description: &#34;Sparta Home&#34;,
    OutputKey: &#34;SpartaHome&#34;,
    OutputValue: &#34;https://github.com/mweagle/Sparta&#34;
  },{
    Description: &#34;Sparta Version&#34;,
    OutputKey: &#34;SpartaVersion&#34;,
    OutputValue: &#34;0.0.7&#34;
  },{
    Description: &#34;API Gateway URL&#34;,
    OutputKey: &#34;URL&#34;,
    OutputValue: &#34;https://7ljn63rysd.execute-api.us-west-2.amazonaws.com/prod&#34;
}]</code></pre>
</p>

<p>Combining the <em>API Gateway URL</em> <code>OutputValue</code> with our resource path (<em>/hello/world/test</em>), we get the absolute URL to our lambda function: <em><a href="https://7ljn63rysd.execute-api.us-west-2.amazonaws.com/prod/hello/world/test">https://7ljn63rysd.execute-api.us-west-2.amazonaws.com/prod/hello/world/test</a></em></p>

<h3 id="a-href-hugoshortcode-10-querying-a:d680e8a854a7cbad6d490c445cba2eba"><a href="#example1Querying:d680e8a854a7cbad6d490c445cba2eba">Querying</a></h3>

<p>Let&rsquo;s query the lambda function and see what the <code>event</code> data is at execution time:</p>

<p><pre><code class="nohighlight">curl -vs https://7ljn63rysd.execute-api.us-west-2.amazonaws.com/prod/hello/world/test
*   Trying 54.240.188.223...
* Connected to 7ljn63rysd.execute-api.us-west-2.amazonaws.com (54.240.188.223) port 443 (#0)
* TLS 1.2 connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
* Server certificate: *.execute-api.us-west-2.amazonaws.com
* Server certificate: Symantec Class 3 Secure Server CA - G4
* Server certificate: VeriSign Class 3 Public Primary Certification Authority - G5
&gt; GET /prod/hello/world/test HTTP/1.1
&gt; Host: 7ljn63rysd.execute-api.us-west-2.amazonaws.com
&gt; User-Agent: curl/7.43.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Content-Type: application/json
&lt; Content-Length: 708
&lt; Connection: keep-alive
&lt; Date: Sat, 05 Dec 2015 21:24:44 GMT
&lt; x-amzn-RequestId: 99dfd15d-9b96-11e5-9705-fdd3a4d9c8bf
&lt; X-Cache: Miss from cloudfront
&lt; Via: 1.1 7a0918c01bce16cc9b165fd895f7dc87.cloudfront.net (CloudFront)
&lt; X-Amz-Cf-Id: rx1cVURKTlc3sla3v59Ekz1YMfVdcUWG1QwFKCFPjjLzHzmL_d6r_w==
&lt;
* Connection #0 to host 7ljn63rysd.execute-api.us-west-2.amazonaws.com left intact
{&#34;code&#34;:200,&#34;status&#34;:&#34;OK&#34;,&#34;headers&#34;:{&#34;date&#34;:&#34;Sun, 06 Dec 2015 15:38:11 GMT&#34;,&#34;content-length&#34;:&#34;970&#34;,&#34;content-type&#34;:&#34;text/plain; charset=utf-8&#34;},&#34;results&#34;:{&#34;method&#34;:&#34;GET)&#34;,&#34;body&#34;:{},&#34;headers&#34;:{&#34;Accept&#34;:&#34;*/*&#34;,&#34;CloudFront-Forwarded-Proto&#34;:&#34;https&#34;,&#34;CloudFront-Is-Desktop-Viewer&#34;:&#34;true&#34;,&#34;CloudFront-Is-Mobile-Viewer&#34;:&#34;false&#34;,&#34;CloudFront-Is-SmartTV-Viewer&#34;:&#34;false&#34;,&#34;CloudFront-Is-Tablet-Viewer&#34;:&#34;false&#34;,&#34;CloudFront-Viewer-Country&#34;:&#34;US&#34;,&#34;Via&#34;:&#34;1.1 cbc24cfe0a4f99decef499f7250bdd71.cloudfront.net (CloudFront)&#34;,&#34;X-Amz-Cf-Id&#34;:&#34;0pnrYxA7vnOaL6I16a7K8luNQTqnD2BtBNVW4WoR-4pt4Dhku50FJA==&#34;,&#34;X-Forwarded-For&#34;:&#34;50.135.43.1, 54.240.158.109&#34;,&#34;X-Forwarded-Port&#34;:&#34;443&#34;,&#34;X-Forwarded-Proto&#34;:&#34;https&#34;},&#34;queryParams&#34;:{},&#34;pathParams&#34;:{},&#34;context&#34;:{&#34;apiId&#34;:&#34;nevml0oa6e&#34;,&#34;method&#34;:&#34;GET&#34;,&#34;requestId&#34;:&#34;5a9fb53c-9c2f-11e5-bb04-c9c55aa2aa00&#34;,&#34;resourceId&#34;:&#34;7619tp&#34;,&#34;resourcePath&#34;:&#34;/hello/world/test&#34;,&#34;stage&#34;:&#34;prod&#34;,&#34;identity&#34;:{&#34;accountId&#34;:&#34;&#34;,&#34;apiKey&#34;:&#34;&#34;,&#34;caller&#34;:&#34;&#34;,&#34;cognitoAuthenticationProvider&#34;:&#34;&#34;,&#34;cognitoAuthenticationType&#34;:&#34;&#34;,&#34;cognitoIdentityId&#34;:&#34;&#34;,&#34;cognitoIdentityPoolId&#34;:&#34;&#34;,&#34;sourceIp&#34;:&#34;50.135.43.1&#34;,&#34;user&#34;:&#34;&#34;,&#34;userAgent&#34;:&#34;curl/7.43.0&#34;,&#34;userArn&#34;:&#34;&#34;}}}}

Pretty-printing the response body to make things more readable:

&lt;pre&gt;&lt;code class=&#34;json&#34;&gt;{
  &amp;#34;code&amp;#34;: 200,
  &amp;#34;status&amp;#34;: &amp;#34;OK&amp;#34;,
  &amp;#34;headers&amp;#34;: {
    &amp;#34;date&amp;#34;: &amp;#34;Sun, 06 Dec 2015 15:38:11 GMT&amp;#34;,
    &amp;#34;content-length&amp;#34;: &amp;#34;970&amp;#34;,
    &amp;#34;content-type&amp;#34;: &amp;#34;text/plain; charset=utf-8&amp;#34;
  },
  &amp;#34;results&amp;#34;: {
    &amp;#34;method&amp;#34;: &amp;#34;GET)&amp;#34;,
    &amp;#34;body&amp;#34;: {},
    &amp;#34;headers&amp;#34;: {
      &amp;#34;Accept&amp;#34;: &amp;#34;*/*&amp;#34;,
      &amp;#34;CloudFront-Forwarded-Proto&amp;#34;: &amp;#34;https&amp;#34;,
      &amp;#34;CloudFront-Is-Desktop-Viewer&amp;#34;: &amp;#34;true&amp;#34;,
      &amp;#34;CloudFront-Is-Mobile-Viewer&amp;#34;: &amp;#34;false&amp;#34;,
      &amp;#34;CloudFront-Is-SmartTV-Viewer&amp;#34;: &amp;#34;false&amp;#34;,
      &amp;#34;CloudFront-Is-Tablet-Viewer&amp;#34;: &amp;#34;false&amp;#34;,
      &amp;#34;CloudFront-Viewer-Country&amp;#34;: &amp;#34;US&amp;#34;,
      &amp;#34;Via&amp;#34;: &amp;#34;1.1 cbc24cfe0a4f99decef499f7250bdd71.cloudfront.net (CloudFront)&amp;#34;,
      &amp;#34;X-Amz-Cf-Id&amp;#34;: &amp;#34;0pnrYxA7vnOaL6I16a7K8luNQTqnD2BtBNVW4WoR-4pt4Dhku50FJA==&amp;#34;,
      &amp;#34;X-Forwarded-For&amp;#34;: &amp;#34;50.135.43.1, 54.240.158.109&amp;#34;,
      &amp;#34;X-Forwarded-Port&amp;#34;: &amp;#34;443&amp;#34;,
      &amp;#34;X-Forwarded-Proto&amp;#34;: &amp;#34;https&amp;#34;
    },
    &amp;#34;queryParams&amp;#34;: {},
    &amp;#34;pathParams&amp;#34;: {},
    &amp;#34;context&amp;#34;: {
      &amp;#34;apiId&amp;#34;: &amp;#34;nevml0oa6e&amp;#34;,
      &amp;#34;method&amp;#34;: &amp;#34;GET&amp;#34;,
      &amp;#34;requestId&amp;#34;: &amp;#34;5a9fb53c-9c2f-11e5-bb04-c9c55aa2aa00&amp;#34;,
      &amp;#34;resourceId&amp;#34;: &amp;#34;7619tp&amp;#34;,
      &amp;#34;resourcePath&amp;#34;: &amp;#34;/hello/world/test&amp;#34;,
      &amp;#34;stage&amp;#34;: &amp;#34;prod&amp;#34;,
      &amp;#34;identity&amp;#34;: {
        &amp;#34;accountId&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;apiKey&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;caller&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;cognitoAuthenticationProvider&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;cognitoAuthenticationType&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;cognitoIdentityId&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;cognitoIdentityPoolId&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;sourceIp&amp;#34;: &amp;#34;50.135.43.1&amp;#34;,
        &amp;#34;user&amp;#34;: &amp;#34;&amp;#34;,
        &amp;#34;userAgent&amp;#34;: &amp;#34;curl/7.43.0&amp;#34;,
        &amp;#34;userArn&amp;#34;: &amp;#34;&amp;#34;
      }
    }
  }
}&lt;/code&gt;&lt;/pre&gt;


While this demonstrates that our lambda function is publicly accessible, it&#39;s not immediately obvious where the `*event` data is being populated.

### &lt;a href=&#34;#example1Mapping:d680e8a854a7cbad6d490c445cba2eba&#34;&gt;Mapping Templates&lt;/a&gt;

The event data that&#39;s actually supplied to `echoS3Event` is returned in the response&#39;s `results` key.  This content is what the API Gateway sends as part of the integration mapping.  We&#39;ll look at the sibling `code`, `status`, and `headers` keys below.

When the API Gateway Method is defined, it optionally includes any  whitelisted query params and header values that should be forwarded to the integration target.  For this example, we&#39;re not whitelisting any params, so those fields (`queryParams`, `pathParams`) are empty.  Then for each integration target (which can be AWS Lambda, a mock, or a HTTP Proxy), it&#39;s possible to transform the API Gateway request data and whitelisted arguments into a format that&#39;s more amenable to the target.

Sparta uses a pass-through template that passes all valid data.  The [Apache Velocity](http://velocity.apache.org) template that [Sparta uses](https://raw.githubusercontent.com/mweagle/Sparta/master/resources/gateway/inputmapping_json.vtl) is:

&lt;pre&gt;&lt;code class=&#34;nohighlight&#34;&gt;#*
Provide an automatic pass through template that transforms all inputs
into the JSON payload sent to a golang function

See
  https://forums.aws.amazon.com/thread.jspa?threadID=220274&amp;amp;tstart=0
  http://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html
*#
{
  &amp;#34;method&amp;#34;: &amp;#34;$context.httpMethod&amp;#34;,
  &amp;#34;body&amp;#34; : $input.json(&amp;#39;$&amp;#39;),
  &amp;#34;headers&amp;#34;: {
    #foreach($param in $input.params().header.keySet())
    &amp;#34;$param&amp;#34;: &amp;#34;$util.escapeJavaScript($input.params().header.get($param))&amp;#34; #if($foreach.hasNext),#end

    #end
  },
  &amp;#34;queryParams&amp;#34;: {
    #foreach($param in $input.params().querystring.keySet())
    &amp;#34;$param&amp;#34;: &amp;#34;$util.escapeJavaScript($input.params().querystring.get($param))&amp;#34; #if($foreach.hasNext),#end

    #end
  },
  &amp;#34;pathParams&amp;#34;: {
    #foreach($param in $input.params().path.keySet())
    &amp;#34;$param&amp;#34;: &amp;#34;$util.escapeJavaScript($input.params().path.get($param))&amp;#34; #if($foreach.hasNext),#end

    #end
  },
  &amp;#34;context&amp;#34; : {
    &amp;#34;apiId&amp;#34; : &amp;#34;$util.escapeJavaScript($context.apiId)&amp;#34;,
    &amp;#34;method&amp;#34; : &amp;#34;$util.escapeJavaScript($context.httpMethod)&amp;#34;,
    &amp;#34;requestId&amp;#34; : &amp;#34;$util.escapeJavaScript($context.requestId)&amp;#34;,
    &amp;#34;resourceId&amp;#34; : &amp;#34;$util.escapeJavaScript($context.resourceId)&amp;#34;,
    &amp;#34;resourcePath&amp;#34; : &amp;#34;$util.escapeJavaScript($context.resourcePath)&amp;#34;,
    &amp;#34;stage&amp;#34; : &amp;#34;$util.escapeJavaScript($context.stage)&amp;#34;,
    &amp;#34;identity&amp;#34; : {
      &amp;#34;accountId&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.accountId)&amp;#34;,
      &amp;#34;apiKey&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.apiKey)&amp;#34;,
      &amp;#34;caller&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.caller)&amp;#34;,
      &amp;#34;cognitoAuthenticationProvider&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.cognitoAuthenticationProvider)&amp;#34;,
      &amp;#34;cognitoAuthenticationType&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.cognitoAuthenticationType)&amp;#34;,
      &amp;#34;cognitoIdentityId&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.cognitoIdentityId)&amp;#34;,
      &amp;#34;cognitoIdentityPoolId&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.cognitoIdentityPoolId)&amp;#34;,
      &amp;#34;sourceIp&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.sourceIp)&amp;#34;,
      &amp;#34;user&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.user)&amp;#34;,
      &amp;#34;userAgent&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.userAgent)&amp;#34;,
      &amp;#34;userArn&amp;#34; : &amp;#34;$util.escapeJavaScript($context.identity.userArn)&amp;#34;
    }
  }
}&lt;/code&gt;&lt;/pre&gt;


This template forwards all whitelisted data &amp; body to the lambda function.  You can see by switching on the `method` field would permit a single function to service multiple HTTP method names.

The next example will show how to unmarshal this data and perform request-specific actions.  

### &lt;a href=&#34;#example1ProxyingEnvelope:d680e8a854a7cbad6d490c445cba2eba&#34;&gt;Proxying Envelope&lt;/a&gt;

The mapping template explains the content of the `results` property, but not the other fields (`code`, `status`, `headers`).  Those fields are injected by the NodeJS proxying tier as part of translating the *Go* HTTP response to a Lambda compatible result.  

A primary benefit of this envelope is to provide an automatic mapping from Integration Response Regular Expression mappings to Method Response codes.  If you look at the **Integration Response** section of the _/hello/world/test_ resource in the Console, you&#39;ll see a list of Regular Expression matches:

![API Gateway](/images/apigateway/IntegrationMapping.png)

The regular expressions are used to translate the integration response, which is just a blob of text provided to `context.done()`, into API Gateway Method responses.  Sparta annotates your lambda functions response with *Go*&#39;s [HTTP StatusText](https://golang.org/src/net/http/status.go) values based on the HTTP status code your lambda function produced.  Sparta also provides a corresponding Method Response entry for all valid HTTP codes:

![API Gateway](/images/apigateway/MethodResponse.png)

These mappings are defaults, and it&#39;s possible to override either one by providing a non-zero length values to either:

  * [Integration.Responses](https://godoc.org/github.com/mweagle/Sparta#Integration).  See the [DefaultIntegrationResponses](https://github.com/mweagle/Sparta/blob/master/apigateway.go#L60) for the default values.
  * [Method.Responses](https://godoc.org/github.com/mweagle/Sparta#Method).  See the [DefaultMethodResponses](https://godoc.org/github.com/mweagle/Sparta#DefaultMethodResponses) for the default method response mappings.

### &lt;a href=&#34;#cleanup:d680e8a854a7cbad6d490c445cba2eba&#34;&gt;Cleaning Up&lt;/a&gt;

Before moving on, remember to decommission the service via:

&lt;pre&gt;&lt;code class=&#34;nohighlight&#34;&gt;go run application.go delete&lt;/code&gt;&lt;/pre&gt;


### &lt;a href=&#34;#example1WrappingUp:d680e8a854a7cbad6d490c445cba2eba&#34;&gt;Wrapping Up&lt;/a&gt;

Now that we know what data is actually being sent to our API Gateway-connected Lambda function, we&#39;ll move on to performing a more complex operation, including returning a custom HTTP response body.

## Other Resources

  * [Mapping Template Reference](http://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html)</code></pre>
</p>

</div>


    
  </div>
</div>
</div>
      <footer class="footer">
    <div class="container hidden-print">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="#">back to top</a>
</div>
<div class="pull-right">
  
</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
          <small>
              
    
<div class="container footline">
  
  <a href="http://www.erlang-embedded.com/why-erlang/">The world is concurrent. Things in the world donâ€™t share data. Things communicate with messages. Things fail.</a>


</div>


    


          </small>
        </div>
     </div>
    </div>
</footer>

    <script src="http://gosparta.io/js/jquery.min-2.1.4.js"></script>
<script src="http://gosparta.io/js/bootstrap.min-3.3.5.js"></script>



<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//mweagle.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="http://gosparta.io/js/highlight.pack.js"></script>
<script src="http://gosparta.io/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



  </body>
</html>

